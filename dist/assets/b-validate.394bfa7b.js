var v=Object.prototype.toString;function y(i){return v.call(i)==="[object Array]"}function f(i){return v.call(i)==="[object Object]"}function V(i){return v.call(i)==="[object String]"}function w(i){return v.call(i)==="[object Number]"&&i===i}function A(i){return v.call(i)==="[object Boolean]"}function _(i){return v.call(i)==="[object Function]"}function S(i){return f(i)&&Object.keys(i).length===0}function b(i){return i==null||i===""}function M(i){return y(i)&&!i.length}var E=function(i,t){if(typeof i!="object"||typeof t!="object")return i===t;if(_(i)&&_(t))return i===t||i.toString()===t.toString();if(Object.keys(i).length!==Object.keys(t).length)return!1;for(var r in i){var a=E(i[r],t[r]);if(!a)return!1}return!0},T=function(i,t){var r={};return Object.keys(i).forEach(function(a){var e=i[a],n=t&&t[a];r[a]=f(e)?Object.assign(Object.assign({},e),n):n||e}),r},$=function(i,t){for(var r=t.split("."),a=i,e=0;e<r.length;e++)if(a=a&&a[r[e]],a===void 0)return a;return a},p="`#{value}` is not a #{type} type",P={required:"#{field} is required",type:{ip:p,email:p,url:p,string:p,number:p,array:p,object:p,boolean:p},number:{min:"`#{value}` is not greater than `#{min}`",max:"`#{value}` is not less than `#{max}`",equal:"`#{value}` is not equal to `#{equal}`",range:"`#{value}` is not in range `#{min} ~ #{max}`",positive:"`#{value}` is not a positive number",negative:"`#{value}` is not a negative number"},array:{length:"The `#{value}` length is not equal to #{length}",minLength:"The `#{value}` length is not greater than #{minLength}",maxLength:"The `#{value}` length is not less than #{maxLength}",includes:"#{value} is not includes #{includes}",deepEqual:"#{value} is not deep equal with #{deepEqual}",empty:"`#{value}` is not an empty array"},string:{maxLength:"The `#{value}` length is not greater than #{maxLength}",minLength:"The `#{value}` length is not less than #{minLength}",length:"The `#{value}` length is not equal to #{length}",match:"`#{value}` is not match pattern #{pattern}",uppercase:"Expect `#{value}` to be uppercased",lowercase:"Expect `#{value}` to be lowercased"},object:{deepEqual:"`#{value}` is not deep equal with #{deepEqual}",hasKeys:"`#{value}` is not has keys #{keys}",empty:"`#{value}` is not an empty object"},boolean:{true:"Expect true but got `#{value}`",false:"Expect false but got `#{value}`"}},l=function(t,r){var a=this;this.getValidateMsg=function(e,n){n===void 0&&(n={});var o=Object.assign(Object.assign({},n),{value:a.obj,field:a.field,type:a.type}),s=$(a.validateMessages,e);return _(s)?s(o):V(s)?s.replace(/\#\{.+?\}/g,function(d){var g=d.slice(2,-1);return g in o?f(o[g])||y(o[g])?JSON.stringify(o[g]):String(o[g]):d}):s},f(r)&&V(t)&&r.trim?this.obj=t.trim():f(r)&&r.ignoreEmptyString&&t===""?this.obj=void 0:this.obj=t,this.message=r.message,this.type=r.type,this.error=null,this.field=r.field||r.type,this.validateMessages=T(P,r.validateMessages)},j={not:{configurable:!0},isRequired:{configurable:!0},end:{configurable:!0}};j.not.get=function(){return this._not=!this._not,this};j.isRequired.get=function(){return(b(this.obj)||M(this.obj))&&(this.error={value:this.obj,type:this.type,requiredError:!0,message:this.message||(this._not?"[NOT MODE]:":"")+this.getValidateMsg("required")}),this};j.end.get=function(){return this.error};l.prototype.addError=function(t){!this.error&&t&&(this.error={value:this.obj,type:this.type,message:this.message||(f(t)?t:(this._not?"[NOT MODE]:":"")+t)})};l.prototype.validate=function(t,r){var a=this._not?t:!t;return a&&this.addError(r),this};l.prototype.collect=function(t){t&&t(this.error)};Object.defineProperties(l.prototype,j);var z=function(i){function t(a,e){i.call(this,a,Object.assign(Object.assign({},e),{type:"string"})),this.validate(e&&e.strict?V(this.obj):!0,this.getValidateMsg("type.string"))}i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t;var r={uppercase:{configurable:!0},lowercase:{configurable:!0}};return t.prototype.maxLength=function(e){return this.obj?this.validate(this.obj.length<=e,this.getValidateMsg("string.maxLength",{maxLength:e})):this},t.prototype.minLength=function(e){return this.obj?this.validate(this.obj.length>=e,this.getValidateMsg("string.minLength",{minLength:e})):this},t.prototype.length=function(e){return this.obj?this.validate(this.obj.length===e,this.getValidateMsg("string.length",{length:e})):this},t.prototype.match=function(e){var n=e instanceof RegExp;return n&&(e.lastIndex=0),this.validate(this.obj===void 0||n&&e.test(this.obj),this.getValidateMsg("string.match",{pattern:e}))},r.uppercase.get=function(){return this.obj?this.validate(this.obj.toUpperCase()===this.obj,this.getValidateMsg("string.uppercase")):this},r.lowercase.get=function(){return this.obj?this.validate(this.obj.toLowerCase()===this.obj,this.getValidateMsg("string.lowercase")):this},Object.defineProperties(t.prototype,r),t}(l),N=function(i){function t(a,e){i.call(this,a,Object.assign(Object.assign({},e),{type:"number"})),this.validate(e&&e.strict?w(this.obj):!0,this.getValidateMsg("type.number"))}i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t;var r={positive:{configurable:!0},negative:{configurable:!0}};return t.prototype.min=function(e){return b(this.obj)?this:this.validate(this.obj>=e,this.getValidateMsg("number.min",{min:e}))},t.prototype.max=function(e){return b(this.obj)?this:this.validate(this.obj<=e,this.getValidateMsg("number.max",{max:e}))},t.prototype.equal=function(e){return b(this.obj)?this:this.validate(this.obj===e,this.getValidateMsg("number.equal",{equal:e}))},t.prototype.range=function(e,n){return b(this.obj)?this:this.validate(this.obj>=e&&this.obj<=n,this.getValidateMsg("number.range",{min:e,max:n}))},r.positive.get=function(){return b(this.obj)?this:this.validate(this.obj>0,this.getValidateMsg("number.positive"))},r.negative.get=function(){return b(this.obj)?this:this.validate(this.obj<0,this.getValidateMsg("number.negative"))},Object.defineProperties(t.prototype,r),t}(l),R=function(i){function t(a,e){i.call(this,a,Object.assign(Object.assign({},e),{type:"array"})),this.validate(e&&e.strict?y(this.obj):!0,this.getValidateMsg("type.array",{value:this.obj,type:this.type}))}i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t;var r={empty:{configurable:!0}};return t.prototype.length=function(e){return this.obj?this.validate(this.obj.length===e,this.getValidateMsg("array.length",{value:this.obj,length:e})):this},t.prototype.minLength=function(e){return this.obj?this.validate(this.obj.length>=e,this.getValidateMsg("array.minLength",{value:this.obj,minLength:e})):this},t.prototype.maxLength=function(e){return this.obj?this.validate(this.obj.length<=e,this.getValidateMsg("array.maxLength",{value:this.obj,maxLength:e})):this},t.prototype.includes=function(e){var n=this;return this.obj?this.validate(e.every(function(o){return n.obj.indexOf(o)!==-1}),this.getValidateMsg("array.includes",{value:this.obj,includes:e})):this},t.prototype.deepEqual=function(e){return this.obj?this.validate(E(this.obj,e),this.getValidateMsg("array.deepEqual",{value:this.obj,deepEqual:e})):this},r.empty.get=function(){return this.validate(M(this.obj),this.getValidateMsg("array.empty",{value:this.obj}))},Object.defineProperties(t.prototype,r),t}(l),C=function(i){function t(a,e){i.call(this,a,Object.assign(Object.assign({},e),{type:"object"})),this.validate(e&&e.strict?f(this.obj):!0,this.getValidateMsg("type.object"))}i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t;var r={empty:{configurable:!0}};return t.prototype.deepEqual=function(e){return this.obj?this.validate(E(this.obj,e),this.getValidateMsg("object.deepEqual",{deepEqual:e})):this},t.prototype.hasKeys=function(e){var n=this;return this.obj?this.validate(e.every(function(o){return n.obj[o]}),this.getValidateMsg("object.hasKeys",{keys:e})):this},r.empty.get=function(){return this.validate(S(this.obj),this.getValidateMsg("object.empty"))},Object.defineProperties(t.prototype,r),t}(l),K=function(i){function t(a,e){i.call(this,a,Object.assign(Object.assign({},e),{type:"boolean"})),this.validate(e&&e.strict?A(this.obj):!0,this.getValidateMsg("type.boolean"))}i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t;var r={true:{configurable:!0},false:{configurable:!0}};return r.true.get=function(){return this.validate(this.obj===!0,this.getValidateMsg("boolean.true"))},r.false.get=function(){return this.validate(this.obj===!1,this.getValidateMsg("boolean.false"))},Object.defineProperties(t.prototype,r),t}(l),D=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,F=new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i"),I=/^(2(5[0-5]{1}|[0-4]\d{1})|[0-1]?\d{1,2})(\.(2(5[0-5]{1}|[0-4]\d{1})|[0-1]?\d{1,2})){3}$/,U=function(i){function t(a,e){i.call(this,a,Object.assign(Object.assign({},e),{type:"type"}))}i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t;var r={email:{configurable:!0},url:{configurable:!0},ip:{configurable:!0}};return r.email.get=function(){return this.type="email",this.validate(this.obj===void 0||D.test(this.obj),this.getValidateMsg("type.email"))},r.url.get=function(){return this.type="url",this.validate(this.obj===void 0||F.test(this.obj),this.getValidateMsg("type.url"))},r.ip.get=function(){return this.type="ip",this.validate(this.obj===void 0||I.test(this.obj),this.getValidateMsg("type.ip"))},Object.defineProperties(t.prototype,r),t}(l),Z=function(i){function t(a,e){i.call(this,a,Object.assign(Object.assign({},e),{type:"custom"}))}i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t;var r={validate:{configurable:!0}};return r.validate.get=function(){var a=this;return function(e,n){var o;if(e)return o=e(a.obj,a.addError.bind(a)),o&&o.then?(n&&o.then(function(){n&&n(a.error)},function(s){console.error(s)}),[o,a]):(n&&n(a.error),a.error)}},Object.defineProperties(t.prototype,r),t}(l),J=function(t,r){this.string=new z(t,r),this.number=new N(t,r),this.array=new R(t,r),this.object=new C(t,r),this.boolean=new K(t,r),this.type=new U(t,r),this.custom=new Z(t,r)},Y=function(t,r){r===void 0&&(r={}),this.schema=t,this.options=r};Y.prototype.validate=function(t,r){var a=this;if(!f(t))return;var e=[],n=null;function o(s,d){n||(n={}),(!n[s]||d.requiredError)&&(n[s]=d)}this.schema&&Object.keys(this.schema).forEach(function(s){if(y(a.schema[s]))for(var d=function(x){var c=a.schema[s][x],m=c.type,L=c.message;if(!m&&!c.validator)throw"You must specify a type to field "+s+"!";var O=new J(t[s],Object.assign(Object.assign({},a.options),{message:L,field:s})),u=O.type[m]||null;if(!u)if(c.validator){u=O.custom.validate(c.validator),Object.prototype.toString.call(u)==="[object Array]"&&u[0].then?e.push({function:u[0],_this:u[1],key:s}):u&&o(s,u);return}else u=O[m];if(Object.keys(c).forEach(function(h){c.required&&(u=u.isRequired),h!=="message"&&u[h]&&c[h]&&typeof u[h]=="object"&&(u=u[h]),u[h]&&c[h]!==void 0&&typeof u[h]=="function"&&(u=u[h](c[h]))}),u.collect(function(h){h&&o(s,h)}),n)return"break"},g=0;g<a.schema[s].length;g++){var q=d(g);if(q==="break")break}}),e.length>0?Promise.all(e.map(function(s){return s.function})).then(function(){e.forEach(function(s){s._this.error&&o(s.key,s._this.error)}),r&&r(n)}):r&&r(n)};export{Y as S};
